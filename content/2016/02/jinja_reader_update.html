<html>
<head>
<title>UPDATED: Using Jinja2 in Pelican Templates</title>
<meta name="date" content="2016-02-02 00:08:00" />
<meta name="modified" content="2016-02-02 00:08:00" />
</head>
<body>
<p>After my last post I tried importing code fragments into jinja templates using the include tag. I ran into the following error multiple times: <code>TypeError: no loader for this environment specified</code>. This is because I was rendering the html as a string, rather than loading the file from the file system. This means there is no context with which to include a template.</p>

<p>To fix this we create an Environment and use a file system loader. I want to be able to import files directly from that template directory, so I set up the path to be relative to the filename. I'm still getting the metadata from <code>HTMLReader.read()</code>, and I would like to make the path lookup a bit more elegant, but for now this will do</p>

<pre><code class="python">
# Anywhere in pelicanconf.py
from pelican.readers import HTMLReader
from jinja2 import FileSystemLoader
from jinja2.environment import Environment

class JinjaReader(HTMLReader):
  def read(self,filename):
    env = Environment()
    BASE_DIR = "content/"
    TEMPLATE_DIR = BASE_DIR+"/".join(filename.split(BASE_DIR)[-1].split("/")[:-1])
    env.loader = FileSystemLoader(TEMPLATE_DIR)
    template = env.get_template(filename.split(TEMPLATE_DIR)[-1])
    body, metadata = super(JinjaReader,self).read(filename)
    return template.render(),metadata

READERS = {
  'html': JinjaReader
}
</code></pre>
</body>
</html>
